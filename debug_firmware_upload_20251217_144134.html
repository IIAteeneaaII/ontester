<HTML xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Pragma" content="no-cache">
<link rel="stylesheet" href="../../../resource/common/style.css?2023021415091518553184798" type="text/css">
<script language="JavaScript" src="../../../resource/common/jquery.min.js?2023021415091518553184798"></script>
<script language="JavaScript" src="../../../resource/common/InitForm.asp?2023021415091518553184798"></script>
<script language="JavaScript" src="../../../Cusjs/InitFormCus.js?2023021415091518553184798"></script>
<link rel="stylesheet" href="../../../Cuscss/english/frame.css?2023021415091518553184798" type="text/css">
<script language="JavaScript" src="../../../resource/common/util.js?2023021415091518553184798"></script>
<script language="JavaScript" src="../../../resource/english/ssmpdes.js?2023021415091518553184798"></script>
<script language="JavaScript" type="text/javascript">
var sysUserType = '0';
var curUserType = '0';
var curWebFrame = 'frame_XGPON';
var CfgModeWord ='TOTALPLAY2';
var isSupportV5 = '1';
var reqFile = "html/ssmp/fireware/firmware.asp";
var ProductType = '1';
var isSupportHoup = '0';
var houpEnable = '';
var turkcellState = {upgradeStatus:0};
var ttNet = '0';

if (CfgModeWord.toUpperCase() == "TURKCELL2") {
    reqFile = "remote/supgrade.html";
}
var HoupUpgradeInfo;
function GetHoupUpGrade() {
    $.ajax({
        type : "POST",
        async : false,
        cache : false,
        url : "./GetUpgradeStatus.asp",
        success : function(data) {
            if (data != "") {
HoupUpgradeInfo = dealDataWithFun(data);
            }
        }
    });
}

function SetUpgrade() {
$.ajax({
        type : "POST",
        async : false,
        cache : false,
        url : "./SetUpgradeStatus.asp",
        success : function(data) {
if (data == 1){
showHoupStatus();
}
        }
    });
}

function GetShowHoupUpGrade() {
    $.ajax({
        type : "POST",
        async : false,
        cache : false,
        url : "./GetUpgradeStatus.asp",
        success : function(data) {
            if (data != "") {
HoupUpgradeInfo = dealDataWithFun(data);
showHoupStatus();
            }
        }
    });
}

function showHoupStatus() {
    if (HoupUpgradeInfo.status == 0) {
$("#ProgressText").html(FirmwareLgeDes["s1137"]);
setDisable("checkProgress", 0);
    } else if (HoupUpgradeInfo.status == 1) {
$("#ProgressText").html(FirmwareLgeDes["s1138"]);
setDisable("checkProgress", 0);
    } else if (HoupUpgradeInfo.status == 2){
$("#ProgressText").html(FirmwareLgeDes["s1132"] + HoupUpgradeInfo.Progress + "%");
setDisable("checkProgress", 1);
    } else if (HoupUpgradeInfo.status == 3) {
$("#ProgressText").html(FirmwareLgeDes["s1136"]);
$("#resetBut").show();
$("#checkProgress").hide();
setDisable("checkProgress", 0);
    } else if (HoupUpgradeInfo.status == 4) {
$("#ProgressText").html(FirmwareLgeDes["s1139"]);
setDisable("checkProgress", 0);
} else if (HoupUpgradeInfo.status == 5) {
$("#ProgressText").html("");
setDisable("checkProgress", 0);
} else if (HoupUpgradeInfo.status == 6) {
$("#ProgressText").html(FirmwareLgeDes["s1152"]);

setDisable("checkProgress", 1);
} else if (HoupUpgradeInfo.status == 7) {
$("#ProgressText").html(FirmwareLgeDes["s1143"]);
setDisable("checkProgress", 1);
}
}

function onReboot() {
    if (ConfirmEx(FirmwareLgeDes['s1140'])) {
        setDisplay("rebootButtonDiv", 0);
        setDisplay("alertExblackBackground", 1);
        $.ajax({
            type : "POST",
            async : true,
            cache : false,
            data : "&x.X_HW_Token=" + getValue('onttoken'),
            url : 'set.cgi?x=InternetGatewayDevice.X_HW_DEBUG.SMP.DM.ResetBoard',
            success : function(data) {
            }
        });
    } else {
        turkcellState.upgradeStatus = 0;
}
}
function setAllDisable()
{
setDisable('f_file',    1);
setDisable('browse',    1);
setDisable('btnBrowse', 1);
setDisable('btnSubmit', 1);
}

function GetLanguageDesc(Name)
{
return FirmwareLgeDes[Name];
}

var AutoUpdateEnable = '1';
function Check_SWM_Status()
{
var xmlHttp = null;

if(window.XMLHttpRequest) {
xmlHttp = new XMLHttpRequest();
} else if(window.ActiveXObject) {
xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
}

xmlHttp.open("GET", "/html/get_swm_status.asp", false);
xmlHttp.send(null);

var swm_status = xmlHttp.responseText;
if (swm_status.substr(1, 1) == "0") {
return true;
} else {
return false;
}
}

function LoadFrame()
{
top.UpgradeFlag = 0;

if("IPONLY" == CfgModeWord.toUpperCase() || "FORANET" == CfgModeWord.toUpperCase() || "TELIA" == CfgModeWord.toUpperCase())
{
setDisplay("tableautoupgrade", 1);
setDisplay("localtext", 1);
setCheck("autoupgrade", AutoUpdateEnable);
}
if ((isSupportHoup == "1")) {
GetHoupUpGrade()
$("#HoupGrade").show();
if (HoupUpgradeInfo.status == "2") {
top.houpGradeFlag = setInterval("GetShowHoupUpGrade();", 2000);
}
}

Object.defineProperty(turkcellState, "upgradeStatus", {
set: function(satus) {
if (satus == 1) {
setDisplay("rebootButtonDiv", 1);
if (ttNet == "1") {
setDisplay("restartONT", 0);
}
}
}
});

if (CfgModeWord.toUpperCase() == "ELISAAP") {
$("#rebootButton").removeClass("ApplyButtoncss buttonwidth_150px").addClass("ApplyButtoncss buttonwidth_180px");
}

if (CfgModeWord.toUpperCase() == "DINFOTEK2") {
        document.getElementById("rebootButton").style.width = "140px";
    }
}

function VerifyFile(FileName)
{
var File = document.getElementsByName(FileName)[0].value;
if (File.length == 0)
{
AlertEx(GetLanguageDesc("s0901"));
return false;
}
if (File.length > 128)
{
AlertEx(GetLanguageDesc("s0902"));
return false;
}

return true;
}

function uploadImage()
{
var uploadForm = document.getElementById("fr_uploadImage");

if (Check_SWM_Status() == false)
{
AlertEx(GetLanguageDesc("s0905"));
return;
}

if (VerifyFile('browse') == false)
{
   return;
}

setDisable('btnSubmit', 1);
ajaxSubmitForm();
setDisplay('informblackBackground', 1);
setDisplay("errorText", 0)
top.UpgradeFlag = 1;
setDisable('browse', 1);
setDisable('btnBrowse',1);
}

function ajaxSubmitForm() {
    var formData = new FormData($("#fr_uploadImage")[0]);
    var result = null;
    var uploadPart = 0.7;
var percent = 0;
    top.ajaxInfo = $.ajax({
        url : "Firmwareupload.cgi?RequestFile=/html/ssmp/fireware/firmware_vdf.asp&FileType=image",
        type : "POST",
        data : formData,
        cache : false,
        contentType : false,
        processData : false,
        xhr:xhrOnProgress(function(data) {
percent = data.loaded / data.total;
            if (percent > uploadPart) {
                percent = (percent - uploadPart) / (1 - uploadPart);
setDisplay("informblackBackground", 0);
setDisplay("errorText", 0)
setDisplay("progressblackBackground", 1);
var widthTemp = $('#progress-bar-box').width();
    widthTemp = parseInt(widthTemp * percent);
    $('#progress-bar-image').width(widthTemp);
            }
        }),
        success: function (data) {
            result = hexDecode(data);
            GetAjaxRet(result);
}
});

}
var xhrOnProgress = function(fun) {
    xhrOnProgress.onprogress = fun;

    return function() {
        var xhr = $.ajaxSettings.xhr();
        if (typeof xhrOnProgress.onprogress !== 'function') {
            return xhr;
        }

        if (xhrOnProgress.onprogress && xhr.upload) {
            xhr.upload.onprogress = xhrOnProgress.onprogress;
        }

        return xhr;
    }
}

function GetAjaxRet(result) {
top.UpgradeFlag = 0;
var retData = result.toLowerCase();
var ret = JSON.parse(retData);
    if (ret.result == 0) {
        setDisplay("progressblackBackground", 0);
        turkcellState.upgradeStatus = 1;
    } else {
setDisplay("progressblackBackground", 0);
setDisplay("errorText", 1)
        setDisable('browse', 0);
        setDisable('btnBrowse',0);
setDisable('btnSubmit', 0);
$("#t_file").val("");
    $("#f_file").val("");
    }
}


</script>
<script language="JavaScript" type="text/javascript">
function fchange()
{
var ffile = document.getElementById("f_file");

var tfile = document.getElementById("t_file");
ffile.value = tfile.value;

var buttonstart = document.getElementById('btnSubmit');
buttonstart.focus();
return ;
}

function StartFileOpt()
{
XmlHttpSendAspFlieWithoutResponse("/html/ssmp/common/StartFileLoad.asp");
}

function ApplayAutoUpgrade()
{
var Form = new webSubmitForm();
Form.addParameter('x.Enable',getCheckVal('autoupgrade'));
Form.addParameter('x.X_HW_Token', getValue('onttoken'));
Form.setAction('set.cgi?x=InternetGatewayDevice.X_HW_AutoUpdate'
                         + '&RequestFile=' + reqFile);
Form.submit();
}
    function isTEData() {
        if (isSupportV5 == 1) {
            return (CfgModeWord == 'TEDATA') || (CfgModeWord == 'TEDATA2');
        } else {
            return false;
        }
    }
    function ResetONT() {
        if (isTEData() == false) {
            return;
        }
        var Title = ResetLgeDes["s0601"];
        if (ConfirmEx(Title)) {
            setDisable('btnReboot', 1);
            var Form = new webSubmitForm();
            Form.setAction('set.cgi?x=InternetGatewayDevice.X_HW_DEBUG.SMP.DM.ResetBoard'
                + '&RequestFile=html/ssmp/fireware/firmware.asp');
            Form.addParameter('x.X_HW_Token', getValue('onttoken'));
            Form.submit();
        }
    }
    function RestoreONT() {
        if (isTEData() == false) {
            return;
        }
        var Title = RestoreLgeDes["s0a01"];

        if (ConfirmEx(Title)) {
            var Form = new webSubmitForm();
            setDisable('btnRestoreDftCfg', 1);
            Form.setAction('restoredefaultcfg.cgi?RequestFile=html/ssmp/fireware/firmware.asp');
            Form.addParameter('x.X_HW_Token', getValue('onttoken'));
            Form.submit();
        }
}

function checkProgressFun() {
setDisable("checkProgress", 1);
$("#ProgressText").html("");
clearInterval(top.houpGradeFlag);
top.houpGradeFlag = setInterval("GetShowHoupUpGrade();", 3000);
if (HoupUpgradeInfo.status != 2 || HoupUpgradeInfo.status != 6) {
SetUpgrade();
}
}
</script>
</head>

<body class="mainbody pageBg" onload="LoadFrame();" marginwidth="0" marginheight="0">
<script language="JavaScript" type="text/javascript">
        if (isTEData()) {
            HWCreatePageHeadInfo("TEDataFirmwareTitle", GetDescFormArrayById(FirmwareLgeDes, "s0915"),
                GetDescFormArrayById(FirmwareLgeDes, "s0916"), false);
            document.write('<br/><br/>');
            HWCreatePageHeadInfo("RebootTitle", GetDescFormArrayById(FirmwareLgeDes, "s0917"), '', false);
        }
    </script>
    <div id="OntReset" style="display:none;">
        <div id="ResetIcon" class="OntResetIcon"></div>
        <div id="ResetButton" class="FloatLeftCss">
            <input type="button" class="bluebuttoncss buttonwidth_120px_140px" id="btnReboot" onclick="ResetONT(this);" value="Restart" bindtext="s1123">
        </div>
        <div id="ResetDes">
            <table height="40px;">
                <tbody><tr>
                    <td class="ResetRestoreSpan" bindtext="s1125">Click it to restart the device.</td>
                </tr>
            </tbody></table>
        </div>
    </div>
    <script>
        if (isTEData()) {
            setDisplay("OntReset", 1);
            document.write('<br/><br/>');
            HWCreatePageHeadInfo("firmware", GetDescFormArrayById(FirmwareLgeDes, "s0918"), '', false);
        }
    </script>
    <div id="OntRestore" style="display:none;">
        <div id="RestoreIcon" class="OntRestoreIcon">
        </div>
        <div id="RestoreButton" class="FloatLeftCss">
            <input type="button" class="bluebuttoncss buttonwidth_140px_300px" id="btnRestoreDftCfg" onclick="RestoreONT(this);" value="Restore Defaults" bindtext="s1127">
        </div>
        <div id="RestoreTips" style="width:420px;">
            <table height="40px;">
                <tbody><tr>
                    <td class="ResetRestoreSpan" bindtext="s1126">Click it to restore the terminal device to its default configurations.</td>
                </tr>
            </tbody></table>
        </div>
    </div>

    <script language="JavaScript" type="text/javascript">
        if (isTEData()) {
            setDisplay("OntRestore", 1);
            document.write('<br/><br/>');
        }
if("IPONLY" == CfgModeWord.toUpperCase() || "FORANET" == CfgModeWord.toUpperCase() || "TELIA" == CfgModeWord.toUpperCase()) 
{<!-- s0900:  "Software Upgrade" -->
HWCreatePageHeadInfo("firmware", GetDescFormArrayById(FirmwareLgeDes, "s0900"), GetDescFormArrayById(FirmwareLgeDes, "s0906a"), false);
}
else{
HWCreatePageHeadInfo("firmware", GetDescFormArrayById(FirmwareLgeDes, "s0900"), GetDescFormArrayById(FirmwareLgeDes, "s0906"), false);
}

</script><div id="firmwaretitle" class="PageTitle_title">Software Upgrade</div><div id="firmware_content" class="PageTitle_content">On this page, you can use the firmware upgrade function to upgrade the software of the terminal to the target version.</div>
<table id="tableautoupgrade" style="display:none;" width="100%">
<tbody><tr>
<td colspan="2" bindtext=""></td>
</tr>
<tr>
<td id="autotext" colspan="2" class="func_title" bindtext="s090a">Automatic Upgrade Configuration</td>
</tr>
<tr>
<td class="width_per15" bindtext="s090c">Enable automatic upgrade</td>
<td class="width_per85" align="left"><input id="autoupgrade" name="autoupgrade" type="checkbox" onclick="ApplayAutoUpgrade();"></td>
</tr>
</tbody></table>
<div class="title_spread"></div>
<form action="Firmwareupload.cgi?RequestFile=/html/ssmp/reset/reset.asp&amp;FileType=image" method="post" enctype="multipart/form-data" name="fr_uploadImage" id="fr_uploadImage">
<table>
<tbody><tr>
<td id="localtext" colspan="3" class="func_title" bindtext="s090b" style="display:none;">Local Upgrade</td>
</tr>
<tr>
<td class="filetitle" bindtext="s0907">Firmware File:</td>
<td>
<div class="filewrap">
<div class="fileupload">
<input type="hidden" name="onttoken" id="hwonttoken" value="8b5d9649e76578776ede2bbea27a8fcc7d581465943ae1cd">
<input type="text" id="f_file" autocomplete="off" readonly="readonly">
<input type="file" name="browse" id="t_file" size="1" onblur="StartFileOpt();" onchange="fchange();" class="osgidisable" disabled="">
<input type="button" id="btnBrowse" class="CancleButtonCss filebuttonwidth_100px osgidisable" bindtext="s0908" value="Browse... " disabled="">
<script>
if (CfgModeWord.toUpperCase() == "DINFOTEK2") {
document.getElementById("btnBrowse").style.backgroundColor = "#0cb433";
}
</script>
</div>
</div>
</td>
<td>
                    <script>
                        if (CfgModeWord == "DICELANDVDF") {
                            document.write('<input class="ApplyButtoncss filebuttonwidth_100px" name="btnSubmit" id="btnSubmit" type="button" onclick="uploadImage();"  BindText="s0909" />')
                        } else {
                            document.write('<input class="CancleButtonCss filebuttonwidth_100px" name="btnSubmit" id="btnSubmit" type="button" onclick="uploadImage();"  BindText="s0909" />')
                        }
                    </script><input class="CancleButtonCss filebuttonwidth_100px osgidisable" name="btnSubmit" id="btnSubmit" type="button" onclick="uploadImage();" bindtext="s0909" value="Upgrade" disabled="">
</td>
</tr>
</tbody></table>
</form>
<div class="blackBackground" id="informblackBackground" style="margin-top: 20px; display: none;">
<div id="informFrom" class="alertpopup">
<div style="display: flex;align-items: center;height: 40px;"><span id="informtitle" bindtext="s1144">Uploading Firmware File</span><img style="margin-left: 10px;" src="../../../images/icon-thinking.gif"></div>
<div class="alerttext"><span id="informspan" bindtext="s1145">The firmware file is being uploaded to the device.</span></div>
</div>
</div>
<div class="blackBackground" id="progressblackBackground" style="">
<div id="progressFrom" class="alertpopup">
<p class="title"><span id="progresstitle" bindtext="s1146">Installing Updated Firmware.</span></p>
<div class="alerttext"><span id="progressspan" bindtext="s1147">Do not turn off your device.</span></div>
<div id="progress-bar-box"><div id="progress-bar-image" style="width: 203px;"></div></div>
</div>
</div>
    <div class="blackBackground" id="rebootButtonDiv" style="display: none;">
        <p class="title"><span id="alertExtitle" bindtext="s1148">Firmware Successfully Updated.</span></p>
        <button id="rebootButton" style="margin-top:10px;" type="button" onclick="onReboot();" class="ApplyButtoncss buttonwidth_150px">
            <script>document.write(PrompterDes['s1010']);</script>Restart
        </button>
</div>
<div class="blackBackground" id="alertExblackBackground" style="display: none;">
<div id="alertExFrom" class="alertpopup">
<p class="title"><span id="alertExtitle" bindtext="s1148">Firmware Successfully Updated.</span></p>
<div class="alerttext"><span id="alertExspan" bindtext="s1149">Your device is now restarting. Please do not turn it off or press any buttons until it has restarted.</span></div>
</div>
</div>
<div class="blackBackground" id="errorText" style="display: none;">
<div id="alertExFrom" class="alertpopup">
<p class="title"><span id="alertExtitle" bindtext="s1150">Firmware Upgrade failed.</span></p>
<div class="alerttext"><span id="alertExspan" bindtext="s1151">Please retry the same update procedure again.</span></div>
</div>
</div>
<div id="HoupGrade" style="margin-top: 60px;display: none;">
<div class="PageTitle_title" bindtext="s1133">Online Upgrade</div>
<div class="PageTitle_content" bindtext="s1141">Click Upgrade. The device automatically connects to the remote server, checks the new software version, and automatically upgrades the software. After the upgrade is successful, the device resets in the early morning for the upgrade to take effect.</div>
<div style="margin-top: 10px;color: #666;">
<input style="height: 30px;width: 120px;" class="CancleButtonCss" name="checkProgress" id="checkProgress" type="button" onclick="checkProgressFun();" bindtext="s1135" value="Upgrade Now">
<input style="height: 30px;width: 70px;display: none;" class="CancleButtonCss" name="resetBut" id="resetBut" type="button" onclick="onReboot();" bindtext="s1142" value="reset">
<div style="margin: 10px 0 0 6px;" id="ProgressText"></div>
</div>
</div>
<br>
<br>
<script>
if (isSupportHoup == '1') {
HWCreatePageHeadInfo("houpupgrade", FirmwareLgeDes["s1155"], "", false);
}
</script>
<div id="chekHoupDiv" style="display: none;margin-top: 15px;">
<div style="position: relative;float: left;">
<input id="chekHoup" type="checkbox" onchange="submithHoupValue()">
</div>
        <span style="font-size: 14px;" class="PageTitle_content" bindtext="s1153">Enable automatic remote upgrade. After automatic upgrade is enabled, the device automatically connects to the remote upgrade platform in the early morning to detect the latest version, upgrades the software automatically, and resets for the upgrade to take effect.</span>
        <br>
        <br>
    </div>
<script>
ParseBindTextByTagName(FirmwareLgeDes, "div",    1);
ParseBindTextByTagName(FirmwareLgeDes, "td",     1);
ParseBindTextByTagName(FirmwareLgeDes, "span",  1);
ParseBindTextByTagName(FirmwareLgeDes, "input",  2);
</script>




</body></HTML>